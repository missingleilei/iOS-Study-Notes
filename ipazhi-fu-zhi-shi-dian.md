#### 一、支付宝支付流程

![](/assets/2122663-a1112187db75bb54.png)

```
第一步：我们的 APP 发起一笔支付交易，此时，第一件事，我们要去我们自己的服务器上创建一个订单信息。同时服务器会组装好一笔交易交给我们。
关于组装交易信息，有两种做法，第一种就是支付宝推荐我们做的，由我们服务器来组装交易信息，服务器加密交易信息，并保存签名信息；
另一种做法是，服务器返回商品信息给 APP，由 APP 来组装交易信息，并进行加密处理等操作。显然我们应该采用第一种方式。
第二步：服务器创建好交易信息以后，返回给 APP，APP 不对交易信息做处理。
第三步：APP 拿到交易信息，开始调起支付宝的 SDK，支付宝的 SDK 把交易信息传给支付宝的服务器。
第四步：验证通过以后，支付宝服务器会告诉支付宝 SDK 验证通过。
第五步：验证通过以后，我们的 APP 会调起支付宝 APP，跳转到支付宝 APP。
第六步：在支付宝 APP 里，用户输入密码进行交易，和支付宝服务器进行通讯。
第七步：支付成功，支付宝服务器回调支付宝 APP。
第八步：支付宝回到我们自己的 APP，并通过 - (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation
 方法处理支付宝的回调结果，对应的进行刷新 UI 等操作。
第九步：支付宝服务器会回调我们的服务器并把收据传给我们服务器，如果我们的服务器没有确认已经收到支付宝的收据信息，
那么支付宝服务器就会一直回调我们的服务器，只是回调时间间隔会越来越久。
第十步：我们的服务器收到支付宝的回调，并回调支付宝，确认已经收到收据信息，此时早餐买完了。
```



